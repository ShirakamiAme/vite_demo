{"ast":null,"code":"// src/api/user.js\nimport axios from './axios.js';\n\n// 用户注册\nexport async function registerUser(userData) {\n  try {\n    const res = await axios.post('/api/users/register', userData, {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n\n    // 验证响应格式\n    if (!res.data || !res.data.user) {\n      throw new Error('无效的响应格式');\n    }\n    return res.data;\n  } catch (error) {\n    // 增强错误处理\n    let errorMessage = '注册失败';\n    if (error.response) {\n      // 后端返回的具体错误信息\n      if (error.response.data && error.response.data.message) {\n        errorMessage = error.response.data.message;\n      } else if (error.response.status === 400) {\n        errorMessage = '请求数据格式错误';\n      } else if (error.response.status === 409) {\n        errorMessage = '用户名或邮箱已存在';\n      }\n    }\n\n    // 创建新的错误对象以保留原始错误\n    const registerError = new Error(errorMessage);\n    registerError.originalError = error;\n    throw registerError;\n  }\n}\n\n// 用户登录\nexport async function loginUser(credentials) {\n  try {\n    const res = await axios.post('/api/users/login', credentials, {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    });\n\n    // 验证响应结构\n    if (!res.data || !res.data.token) {\n      throw new Error('无效的响应格式');\n    }\n    return res.data;\n  } catch (error) {\n    // 增强错误处理\n    let errorMessage = '登录失败';\n    if (error.response) {\n      // 从后端获取具体错误信息\n      if (error.response.data && error.response.data.message) {\n        errorMessage = error.response.data.message;\n      } else if (error.response.status === 401) {\n        errorMessage = '用户名或密码错误';\n      } else if (error.response.status === 400) {\n        errorMessage = '请求数据格式错误';\n      }\n    } else if (error.request) {\n      errorMessage = '无法连接到服务器，请检查网络';\n    } else {\n      errorMessage = error.message;\n    }\n\n    // 创建新的错误对象以保留原始错误\n    const loginError = new Error(errorMessage);\n    loginError.originalError = error;\n    throw loginError;\n  }\n}\n\n// 获取当前用户信息\nexport async function getCurrentUser() {\n  try {\n    const res = await axios.get('/api/users/me');\n\n    // 验证响应格式\n    if (!res.data || !res.data.user) {\n      throw new Error('无效的响应格式');\n    }\n    return res.data;\n  } catch (error) {\n    let errorMessage = '获取用户信息失败';\n    if (error.response) {\n      if (error.response.status === 401) {\n        errorMessage = '未授权，请重新登录';\n      }\n    }\n    const userError = new Error(errorMessage);\n    userError.originalError = error;\n    throw userError;\n  }\n}","map":{"version":3,"names":["axios","registerUser","userData","res","post","headers","data","user","Error","error","errorMessage","response","message","status","registerError","originalError","loginUser","credentials","token","request","loginError","getCurrentUser","get","userError"],"sources":["D:/计算机/谭/shopping_website/src/api/user.js"],"sourcesContent":["// src/api/user.js\r\nimport axios from './axios.js';\r\n\r\n// 用户注册\r\nexport async function registerUser(userData) {\r\n    try {\r\n        const res = await axios.post('/api/users/register', userData, {\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            }\r\n        });\r\n\r\n        // 验证响应格式\r\n        if (!res.data || !res.data.user) {\r\n            throw new Error('无效的响应格式');\r\n        }\r\n\r\n        return res.data;\r\n    } catch (error) {\r\n        // 增强错误处理\r\n        let errorMessage = '注册失败';\r\n\r\n        if (error.response) {\r\n            // 后端返回的具体错误信息\r\n            if (error.response.data && error.response.data.message) {\r\n                errorMessage = error.response.data.message;\r\n            } else if (error.response.status === 400) {\r\n                errorMessage = '请求数据格式错误';\r\n            } else if (error.response.status === 409) {\r\n                errorMessage = '用户名或邮箱已存在';\r\n            }\r\n        }\r\n\r\n        // 创建新的错误对象以保留原始错误\r\n        const registerError = new Error(errorMessage);\r\n        registerError.originalError = error;\r\n        throw registerError;\r\n    }\r\n}\r\n\r\n// 用户登录\r\nexport async function loginUser(credentials) {\r\n    try {\r\n        const res = await axios.post('/api/users/login', credentials, {\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            }\r\n        });\r\n\r\n        // 验证响应结构\r\n        if (!res.data || !res.data.token) {\r\n            throw new Error('无效的响应格式');\r\n        }\r\n\r\n        return res.data;\r\n    } catch (error) {\r\n        // 增强错误处理\r\n        let errorMessage = '登录失败';\r\n\r\n        if (error.response) {\r\n            // 从后端获取具体错误信息\r\n            if (error.response.data && error.response.data.message) {\r\n                errorMessage = error.response.data.message;\r\n            } else if (error.response.status === 401) {\r\n                errorMessage = '用户名或密码错误';\r\n            } else if (error.response.status === 400) {\r\n                errorMessage = '请求数据格式错误';\r\n            }\r\n        } else if (error.request) {\r\n            errorMessage = '无法连接到服务器，请检查网络';\r\n        } else {\r\n            errorMessage = error.message;\r\n        }\r\n\r\n        // 创建新的错误对象以保留原始错误\r\n        const loginError = new Error(errorMessage);\r\n        loginError.originalError = error;\r\n        throw loginError;\r\n    }\r\n}\r\n\r\n// 获取当前用户信息\r\nexport async function getCurrentUser() {\r\n    try {\r\n        const res = await axios.get('/api/users/me');\r\n\r\n        // 验证响应格式\r\n        if (!res.data || !res.data.user) {\r\n            throw new Error('无效的响应格式');\r\n        }\r\n\r\n        return res.data;\r\n    } catch (error) {\r\n        let errorMessage = '获取用户信息失败';\r\n\r\n        if (error.response) {\r\n            if (error.response.status === 401) {\r\n                errorMessage = '未授权，请重新登录';\r\n            }\r\n        }\r\n\r\n        const userError = new Error(errorMessage);\r\n        userError.originalError = error;\r\n        throw userError;\r\n    }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
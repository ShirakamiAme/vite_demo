{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport { ref } from 'vue';\nimport axios from '@/api/axios'; // 确保你有封装 axios 实例\n\nexport default {\n  __name: 'ShoppingCart',\n  props: {\n    product: {\n      type: Object,\n      required: true\n    }\n  },\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const props = __props;\n    const quantity = ref(1);\n    function calculateDiscountPrice(originalPrice, discount) {\n      return (originalPrice * (1 - discount)).toFixed(2);\n    }\n    function getStarIcon(index) {\n      const rating = props.product.rating;\n      if (index <= Math.floor(rating)) {\n        return ['fas', 'star'];\n      } else if (index === Math.ceil(rating) && rating % 1 !== 0) {\n        return ['fas', 'star-half-alt'];\n      } else {\n        return ['far', 'star'];\n      }\n    }\n    function increment() {\n      if (quantity.value < Math.min(10, props.product.stock)) {\n        quantity.value++;\n      }\n    }\n    function decrement() {\n      if (quantity.value > 1) quantity.value--;\n    }\n    async function addToCart() {\n      const userJson = localStorage.getItem('user');\n      if (!userJson) {\n        alert('请先登录');\n        window.location.href = '/login';\n        return;\n      }\n      try {\n        const user = JSON.parse(userJson);\n        const username = user.user_name;\n\n        // 获取用户ID\n        const res = await axios.get('/users');\n        const foundUser = res.data.data.find(u => u.user_name === username);\n        if (!foundUser) {\n          alert('用户信息无效，请重新登录');\n          return;\n        }\n        const user_id = foundUser.user_id;\n\n        // 添加到购物车\n        await axios.post('/cart', {\n          user_id,\n          product_id: props.product.product_id,\n          quantity: quantity.value,\n          price_at_add: props.product.discount > 0 ? parseFloat(calculateDiscountPrice(props.product.original_price, props.product.discount)) : props.product.original_price\n        });\n        alert('已添加到购物车！');\n      } catch (err) {\n        console.error('添加到购物车失败', err);\n        alert('添加失败，请稍后再试');\n      }\n    }\n    const __returned__ = {\n      props,\n      quantity,\n      calculateDiscountPrice,\n      getStarIcon,\n      increment,\n      decrement,\n      addToCart,\n      ref,\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","axios","props","__props","quantity","calculateDiscountPrice","originalPrice","discount","toFixed","getStarIcon","index","rating","product","Math","floor","ceil","increment","value","min","stock","decrement","addToCart","userJson","localStorage","getItem","alert","window","location","href","user","JSON","parse","username","user_name","res","get","foundUser","data","find","u","user_id","post","product_id","price_at_add","parseFloat","original_price","err","console","error"],"sources":["D:/计算机/谭/shopping_website/src/views/ShoppingCart.vue"],"sourcesContent":["<template>\r\n  <div class=\"cart-container\">\r\n    <div class=\"cart-header\">\r\n      <h1 class=\"section-title\">我的购物车</h1>\r\n      <p class=\"cart-summary\" v-if=\"isLoggedIn\">共 {{ cartItems.length }} 件商品</p>\r\n    </div>\r\n\r\n    <div v-if=\"!isLoggedIn\" class=\"not-logged-in\">\r\n      <p>您尚未登录，请先 <a href=\"/login\">登录</a> 查看购物车。</p>\r\n    </div>\r\n\r\n    <div v-else class=\"cart-content\">\r\n      <div class=\"cart-items\">\r\n        <div v-if=\"loading\" class=\"loading-message\">正在加载购物车...</div>\r\n        <div v-else-if=\"error\" class=\"error-message\">{{ error }}</div>\r\n        <div v-else-if=\"cartItems.length === 0\" class=\"empty-cart\">购物车为空</div>\r\n\r\n        <div v-else>\r\n          <div class=\"cart-item\" v-for=\"item in cartItems\" :key=\"item.cart_id\">\r\n            <div class=\"item-image\">\r\n              <img :src=\"item.image\" :alt=\"item.name\" class=\"product-img\">\r\n            </div>\r\n            <div class=\"item-details\">\r\n              <h3 class=\"product-name\">{{ item.name }}</h3>\r\n            </div>\r\n            <div class=\"item-price\">\r\n              <p class=\"price\">¥{{ item.price_at_add.toFixed(2) }}</p>\r\n            </div>\r\n            <div class=\"item-quantity\">\r\n              <span class=\"quantity\">{{ item.quantity }}</span>\r\n            </div>\r\n            <div class=\"item-subtotal\">\r\n              <p class=\"subtotal\">¥{{ (item.price_at_add * item.quantity).toFixed(2) }}</p>\r\n            </div>\r\n            <div class=\"item-actions\">\r\n              <button class=\"action-btn delete\" @click=\"removeItem(item)\">\r\n                <font-awesome-icon :icon=\"['fas', 'trash']\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"cart-summary feathered-edge\" v-if=\"cartItems.length > 0\">\r\n        <div class=\"summary-header\">\r\n          <h3>订单摘要</h3>\r\n        </div>\r\n        <div class=\"summary-content\">\r\n          <div class=\"summary-row\">\r\n            <span>商品小计</span>\r\n            <span>¥{{ subtotal.toFixed(2) }}</span>\r\n          </div>\r\n          <div class=\"summary-row\">\r\n            <span>运费</span>\r\n            <span>¥{{ shippingFee.toFixed(2) }}</span>\r\n          </div>\r\n          <div class=\"summary-divider\"></div>\r\n          <div class=\"summary-row total\">\r\n            <span>总计</span>\r\n            <span>¥{{ total.toFixed(2) }}</span>\r\n          </div>\r\n        </div>\r\n        <button class=\"btn checkout-btn\" @click=\"proceedToCheckout\">\r\n          前往结账\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport axios from '@/api/axios' // 确保你有封装 axios 实例\r\n\r\nconst props = defineProps({\r\n  product: {\r\n    type: Object,\r\n    required: true\r\n  }\r\n})\r\n\r\nconst quantity = ref(1)\r\n\r\nfunction calculateDiscountPrice(originalPrice, discount) {\r\n  return (originalPrice * (1 - discount)).toFixed(2)\r\n}\r\n\r\nfunction getStarIcon(index) {\r\n  const rating = props.product.rating;\r\n\r\n  if (index <= Math.floor(rating)) {\r\n    return ['fas', 'star'];\r\n  } else if (index === Math.ceil(rating) && rating % 1 !== 0) {\r\n    return ['fas', 'star-half-alt'];\r\n  } else {\r\n    return ['far', 'star'];\r\n  }\r\n}\r\n\r\nfunction increment() {\r\n  if (quantity.value < Math.min(10, props.product.stock)) {\r\n    quantity.value++\r\n  }\r\n}\r\n\r\nfunction decrement() {\r\n  if (quantity.value > 1) quantity.value--\r\n}\r\n\r\nasync function addToCart() {\r\n  const userJson = localStorage.getItem('user')\r\n  if (!userJson) {\r\n    alert('请先登录')\r\n    window.location.href = '/login'\r\n    return\r\n  }\r\n\r\n  try {\r\n    const user = JSON.parse(userJson)\r\n    const username = user.user_name\r\n\r\n    // 获取用户ID\r\n    const res = await axios.get('/users')\r\n    const foundUser = res.data.data.find(u => u.user_name === username)\r\n\r\n    if (!foundUser) {\r\n      alert('用户信息无效，请重新登录')\r\n      return\r\n    }\r\n\r\n    const user_id = foundUser.user_id\r\n\r\n    // 添加到购物车\r\n    await axios.post('/cart', {\r\n      user_id,\r\n      product_id: props.product.product_id,\r\n      quantity: quantity.value,\r\n      price_at_add: props.product.discount > 0\r\n          ? parseFloat(calculateDiscountPrice(props.product.original_price, props.product.discount))\r\n          : props.product.original_price\r\n    })\r\n\r\n    alert('已添加到购物车！')\r\n\r\n  } catch (err) {\r\n    console.error('添加到购物车失败', err)\r\n    alert('添加失败，请稍后再试')\r\n  }\r\n}\r\n</script>\r\n\r\n\r\n<style>\r\n.cart-container {\r\n  max-width: 1400px;\r\n  margin: 40px auto;\r\n  padding: 0 20px;\r\n}\r\n\r\n.cart-header {\r\n  margin-bottom: 30px;\r\n  border-bottom: 2px solid var(--color3);\r\n  padding-bottom: 20px;\r\n}\r\n\r\n.cart-summary {\r\n  color: var(--color4);\r\n  font-size: 18px;\r\n  margin-top: 10px;\r\n}\r\n\r\n.cart-content {\r\n  display: flex;\r\n  gap: 30px;\r\n}\r\n\r\n.cart-items {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 20px;\r\n}\r\n\r\n.cart-item {\r\n  display: flex;\r\n  background: white;\r\n  border-radius: 15px;\r\n  padding: 20px;\r\n  box-shadow: var(--shadow);\r\n  transition: var(--transition);\r\n  align-items: center;\r\n}\r\n\r\n.cart-item:hover {\r\n  transform: translateY(-5px);\r\n  box-shadow: 0 8px 20px rgba(0,0,0,0.12);\r\n}\r\n\r\n.item-image {\r\n  width: 120px;\r\n  height: 120px;\r\n  margin: 0 20px;\r\n  border-radius: 10px;\r\n  overflow: hidden;\r\n}\r\n\r\n.product-img {\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: cover;\r\n  transition: var(--transition);\r\n}\r\n\r\n.product-img:hover {\r\n  transform: scale(1.05);\r\n}\r\n\r\n.item-details {\r\n  flex: 1;\r\n  padding-right: 20px;\r\n}\r\n\r\n.product-name {\r\n  font-family: 'Playfair Display', serif;\r\n  font-size: 20px;\r\n  color: var(--color5);\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.item-price {\r\n  width: 120px;\r\n  text-align: right;\r\n  padding-right: 20px;\r\n}\r\n\r\n.price {\r\n  font-size: 18px;\r\n  font-weight: 700;\r\n  color: var(--color4);\r\n}\r\n\r\n.item-quantity {\r\n  width: 120px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 10px;\r\n}\r\n\r\n.quantity {\r\n  min-width: 30px;\r\n  text-align: center;\r\n  font-weight: 500;\r\n}\r\n\r\n.item-subtotal {\r\n  width: 100px;\r\n  text-align: right;\r\n  padding-right: 20px;\r\n}\r\n\r\n.subtotal {\r\n  font-size: 18px;\r\n  font-weight: 700;\r\n  color: var(--color5);\r\n}\r\n\r\n.item-actions {\r\n  width: 80px;\r\n  display: flex;\r\n  gap: 10px;\r\n}\r\n\r\n.action-btn {\r\n  width: 36px;\r\n  height: 36px;\r\n  border-radius: 50%;\r\n  border: none;\r\n  background: var(--color1);\r\n  color: var(--color4);\r\n  cursor: pointer;\r\n  transition: var(--transition);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.action-btn:hover {\r\n  background: var(--color3);\r\n  color: white;\r\n}\r\n\r\n.delete:hover {\r\n  background: #ff6b6b;\r\n}\r\n\r\n.cart-summary.feathered-edge {\r\n  width: 350px;\r\n  background: white;\r\n  border-radius: 15px;\r\n  padding: 25px;\r\n  box-shadow: var(--shadow);\r\n  position: relative;\r\n}\r\n\r\n.summary-header {\r\n  border-bottom: 2px solid var(--color2);\r\n  padding-bottom: 15px;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.summary-header h3 {\r\n  font-family: 'Playfair Display', serif;\r\n  font-size: 24px;\r\n  color: var(--color5);\r\n}\r\n\r\n.summary-content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 15px;\r\n  margin-bottom: 25px;\r\n}\r\n\r\n.summary-row {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  font-size: 16px;\r\n  color: var(--color5);\r\n}\r\n\r\n.summary-divider {\r\n  height: 1px;\r\n  background: var(--color2);\r\n  margin: 10px 0;\r\n}\r\n\r\n.total {\r\n  font-weight: 700;\r\n  font-size: 20px;\r\n  margin-top: 10px;\r\n}\r\n\r\n.checkout-btn {\r\n  width: 100%;\r\n  padding: 16px;\r\n  font-size: 18px;\r\n  font-weight: 600;\r\n}\r\n\r\n.not-logged-in {\r\n  text-align: center;\r\n  padding: 40px;\r\n  font-size: 18px;\r\n  color: #666;\r\n}\r\n\r\n.loading-message,\r\n.error-message,\r\n.empty-cart {\r\n  text-align: center;\r\n  padding: 40px;\r\n  font-size: 18px;\r\n}\r\n\r\n.error-message {\r\n  color: #ff6b6b;\r\n}\r\n\r\n/* 响应式设计 */\r\n@media (max-width: 992px) {\r\n  .cart-content {\r\n    flex-direction: column;\r\n  }\r\n\r\n  .cart-summary.feathered-edge {\r\n    width: 100%;\r\n  }\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .cart-item {\r\n    flex-wrap: wrap;\r\n    position: relative;\r\n    padding: 15px;\r\n  }\r\n\r\n  .item-image {\r\n    width: 80px;\r\n    height: 80px;\r\n    margin: 0 10px 0 0;\r\n  }\r\n\r\n  .item-price {\r\n    width: auto;\r\n    position: absolute;\r\n    top: 20px;\r\n    right: 20px;\r\n  }\r\n\r\n  .item-quantity {\r\n    width: auto;\r\n    margin: 10px 0;\r\n  }\r\n\r\n  .item-subtotal {\r\n    width: auto;\r\n    margin-right: 40px;\r\n  }\r\n\r\n  .item-actions {\r\n    position: absolute;\r\n    top: 15px;\r\n    right: 15px;\r\n  }\r\n}\r\n\r\n@media (max-width: 576px) {\r\n  .cart-header {\r\n    text-align: center;\r\n  }\r\n\r\n  .section-title {\r\n    font-size: 28px;\r\n  }\r\n\r\n  .cart-item {\r\n    padding: 15px 10px;\r\n  }\r\n\r\n  .item-details {\r\n    padding-right: 10px;\r\n  }\r\n}\r\n</style>\r\n"],"mappings":";;AAuEA,SAASA,GAAG,QAAQ,KAAK;AACzB,OAAOC,KAAK,MAAM,aAAa,EAAC;;;;;;;;;;;;;;IAEhC,MAAMC,KAAK,GAAGC,OAKZ;IAEF,MAAMC,QAAQ,GAAGJ,GAAG,CAAC,CAAC,CAAC;IAEvB,SAASK,sBAAsBA,CAACC,aAAa,EAAEC,QAAQ,EAAE;MACvD,OAAO,CAACD,aAAa,IAAI,CAAC,GAAGC,QAAQ,CAAC,EAAEC,OAAO,CAAC,CAAC,CAAC;IACpD;IAEA,SAASC,WAAWA,CAACC,KAAK,EAAE;MAC1B,MAAMC,MAAM,GAAGT,KAAK,CAACU,OAAO,CAACD,MAAM;MAEnC,IAAID,KAAK,IAAIG,IAAI,CAACC,KAAK,CAACH,MAAM,CAAC,EAAE;QAC/B,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC;MACxB,CAAC,MAAM,IAAID,KAAK,KAAKG,IAAI,CAACE,IAAI,CAACJ,MAAM,CAAC,IAAIA,MAAM,GAAG,CAAC,KAAK,CAAC,EAAE;QAC1D,OAAO,CAAC,KAAK,EAAE,eAAe,CAAC;MACjC,CAAC,MAAM;QACL,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC;MACxB;IACF;IAEA,SAASK,SAASA,CAAA,EAAG;MACnB,IAAIZ,QAAQ,CAACa,KAAK,GAAGJ,IAAI,CAACK,GAAG,CAAC,EAAE,EAAEhB,KAAK,CAACU,OAAO,CAACO,KAAK,CAAC,EAAE;QACtDf,QAAQ,CAACa,KAAK,EAAE;MAClB;IACF;IAEA,SAASG,SAASA,CAAA,EAAG;MACnB,IAAIhB,QAAQ,CAACa,KAAK,GAAG,CAAC,EAAEb,QAAQ,CAACa,KAAK,EAAE;IAC1C;IAEA,eAAeI,SAASA,CAAA,EAAG;MACzB,MAAMC,QAAQ,GAAGC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC;MAC7C,IAAI,CAACF,QAAQ,EAAE;QACbG,KAAK,CAAC,MAAM,CAAC;QACbC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,QAAQ;QAC/B;MACF;MAEA,IAAI;QACF,MAAMC,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACT,QAAQ,CAAC;QACjC,MAAMU,QAAQ,GAAGH,IAAI,CAACI,SAAS;;QAE/B;QACA,MAAMC,GAAG,GAAG,MAAMjC,KAAK,CAACkC,GAAG,CAAC,QAAQ,CAAC;QACrC,MAAMC,SAAS,GAAGF,GAAG,CAACG,IAAI,CAACA,IAAI,CAACC,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACN,SAAS,KAAKD,QAAQ,CAAC;QAEnE,IAAI,CAACI,SAAS,EAAE;UACdX,KAAK,CAAC,cAAc,CAAC;UACrB;QACF;QAEA,MAAMe,OAAO,GAAGJ,SAAS,CAACI,OAAO;;QAEjC;QACA,MAAMvC,KAAK,CAACwC,IAAI,CAAC,OAAO,EAAE;UACxBD,OAAO;UACPE,UAAU,EAAExC,KAAK,CAACU,OAAO,CAAC8B,UAAU;UACpCtC,QAAQ,EAAEA,QAAQ,CAACa,KAAK;UACxB0B,YAAY,EAAEzC,KAAK,CAACU,OAAO,CAACL,QAAQ,GAAG,CAAC,GAClCqC,UAAU,CAACvC,sBAAsB,CAACH,KAAK,CAACU,OAAO,CAACiC,cAAc,EAAE3C,KAAK,CAACU,OAAO,CAACL,QAAQ,CAAC,CAAC,GACxFL,KAAK,CAACU,OAAO,CAACiC;QACtB,CAAC,CAAC;QAEFpB,KAAK,CAAC,UAAU,CAAC;MAEnB,CAAC,CAAC,OAAOqB,GAAG,EAAE;QACZC,OAAO,CAACC,KAAK,CAAC,UAAU,EAAEF,GAAG,CAAC;QAC9BrB,KAAK,CAAC,YAAY,CAAC;MACrB;IACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import { toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, normalizeStyle as _normalizeStyle, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, resolveComponent as _resolveComponent, normalizeClass as _normalizeClass, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"product-card\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"product-badge\"\n};\nconst _hoisted_3 = {\n  class: \"product-info\"\n};\nconst _hoisted_4 = {\n  class: \"product-rating\"\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"product-price\"\n};\nconst _hoisted_6 = {\n  class: \"original-price\"\n};\nconst _hoisted_7 = {\n  class: \"discount-price\"\n};\nconst _hoisted_8 = {\n  key: 1,\n  class: \"normal-price\"\n};\nconst _hoisted_9 = {\n  class: \"add-to-cart\"\n};\nconst _hoisted_10 = {\n  class: \"quantity\"\n};\nconst _hoisted_11 = {\n  class: \"stock-info\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_font_awesome_icon = _resolveComponent(\"font-awesome-icon\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [$props.product.discount > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, \" -\" + _toDisplayString(Math.round($props.product.discount * 100)) + \"% \", 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", {\n    class: \"product-img\",\n    style: _normalizeStyle({\n      backgroundImage: `url(${$props.product.image})`\n    })\n  }, null, 4 /* STYLE */), _createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"h3\", null, _toDisplayString($props.product.name), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_4, [(_openBlock(), _createElementBlock(_Fragment, null, _renderList(5, i => {\n    return _createVNode(_component_font_awesome_icon, {\n      key: i,\n      icon: $setup.getStarIcon(i),\n      class: _normalizeClass({\n        'half-star': i === Math.ceil($props.product.rating) && $props.product.rating % 1 !== 0\n      })\n    }, null, 8 /* PROPS */, [\"icon\", \"class\"]);\n  }), 64 /* STABLE_FRAGMENT */))]), $props.product.discount > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createElementVNode(\"span\", _hoisted_6, \"$\" + _toDisplayString($props.product.original_price), 1 /* TEXT */), _createElementVNode(\"span\", _hoisted_7, \" $\" + _toDisplayString($setup.calculateDiscountPrice($props.product.original_price, $props.product.discount)), 1 /* TEXT */)])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_8, \" $\" + _toDisplayString($props.product.original_price), 1 /* TEXT */)), _createElementVNode(\"div\", _hoisted_9, [_createElementVNode(\"div\", _hoisted_10, [_createElementVNode(\"button\", {\n    onClick: $setup.decrement\n  }, \"-\"), _createElementVNode(\"span\", null, _toDisplayString($setup.quantity), 1 /* TEXT */), _createElementVNode(\"button\", {\n    onClick: $setup.increment\n  }, \"+\")]), _createElementVNode(\"button\", {\n    class: \"cart-btn\",\n    onClick: $setup.addToCart\n  }, [_createVNode(_component_font_awesome_icon, {\n    icon: ['fas', 'shopping-cart']\n  })])]), _createElementVNode(\"div\", _hoisted_11, \" Stock: \" + _toDisplayString($props.product.stock), 1 /* TEXT */)])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","$props","product","discount","_hoisted_2","_toDisplayString","Math","round","_createElementVNode","style","_normalizeStyle","backgroundImage","image","_hoisted_3","name","_hoisted_4","_Fragment","_renderList","i","_createVNode","_component_font_awesome_icon","key","icon","$setup","getStarIcon","_normalizeClass","ceil","rating","_hoisted_5","_hoisted_6","original_price","_hoisted_7","calculateDiscountPrice","_hoisted_8","_hoisted_9","_hoisted_10","onClick","decrement","quantity","increment","addToCart","_hoisted_11","stock"],"sources":["D:\\计算机\\谭\\shopping_website\\src\\components\\common\\ProductCard.vue"],"sourcesContent":["<template>\r\n  <div class=\"product-card\">\r\n    <div\r\n        class=\"product-badge\"\r\n        v-if=\"product.discount > 0\"\r\n    >\r\n      -{{ Math.round(product.discount * 100) }}%\r\n    </div>\r\n\r\n    <div\r\n        class=\"product-img\"\r\n        :style=\"{ backgroundImage: `url(${product.image})` }\"\r\n    ></div>\r\n\r\n    <div class=\"product-info\">\r\n      <h3>{{ product.name }}</h3>\r\n\r\n      <div class=\"product-rating\">\r\n        <font-awesome-icon\r\n            v-for=\"i in 5\"\r\n            :key=\"i\"\r\n            :icon=\"getStarIcon(i)\"\r\n            :class=\"{ 'half-star': i === Math.ceil(product.rating) && product.rating % 1 !== 0 }\"\r\n        />\r\n      </div>\r\n\r\n      <div class=\"product-price\" v-if=\"product.discount > 0\">\r\n        <span class=\"original-price\">${{ product.original_price }}</span>\r\n        <span class=\"discount-price\">\r\n          ${{ calculateDiscountPrice(product.original_price, product.discount) }}\r\n        </span>\r\n      </div>\r\n      <div class=\"normal-price\" v-else>\r\n        ${{ product.original_price }}\r\n      </div>\r\n\r\n      <div class=\"add-to-cart\">\r\n        <div class=\"quantity\">\r\n          <button @click=\"decrement\">-</button>\r\n          <span>{{ quantity }}</span>\r\n          <button @click=\"increment\">+</button>\r\n        </div>\r\n        <button class=\"cart-btn\" @click=\"addToCart\">\r\n          <font-awesome-icon :icon=\"['fas', 'shopping-cart']\" />\r\n        </button>\r\n      </div>\r\n\r\n      <div class=\"stock-info\">\r\n        Stock: {{ product.stock }}\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport axios from '@/api/axios' // ✅ 请确认你有配置封装的 axios 实例\r\n\r\nconst props = defineProps({\r\n  product: {\r\n    type: Object,\r\n    required: true\r\n  }\r\n})\r\n\r\nconst quantity = ref(1)\r\n\r\nfunction calculateDiscountPrice(originalPrice, discount) {\r\n  return (originalPrice * (1 - discount)).toFixed(2)\r\n}\r\n\r\nfunction getStarIcon(index) {\r\n  const rating = props.product.rating;\r\n\r\n  if (index <= Math.floor(rating)) {\r\n    return ['fas', 'star'];\r\n  } else if (index === Math.ceil(rating) && rating % 1 !== 0) {\r\n    return ['fas', 'star-half-alt'];\r\n  } else {\r\n    return ['far', 'star'];\r\n  }\r\n}\r\n\r\nfunction increment() {\r\n  if (quantity.value < Math.min(10, props.product.stock)) {\r\n    quantity.value++\r\n  }\r\n}\r\n\r\nfunction decrement() {\r\n  if (quantity.value > 1) quantity.value--\r\n}\r\n\r\nasync function addToCart() {\r\n  // 1. 判断是否登录\r\n  const userJson = localStorage.getItem('user')\r\n  if (!userJson) {\r\n    alert('请先登录再添加到购物车')\r\n    window.location.href = '/login'\r\n    return\r\n  }\r\n\r\n  let user_id = null\r\n  try {\r\n    const user = JSON.parse(userJson)\r\n    const res = await axios.get('/users')\r\n    const foundUser = res.data.data.find(u => u.user_name === user.user_name)\r\n    if (!foundUser) {\r\n      alert('未找到该用户信息')\r\n      return\r\n    }\r\n    user_id = foundUser.user_id\r\n  } catch (err) {\r\n    console.error('获取用户信息失败', err)\r\n    alert('获取用户信息失败')\r\n    return\r\n  }\r\n\r\n  // 2. 构造请求体\r\n  const cartData = {\r\n    user_id,\r\n    product_id: props.product.product_id,\r\n    quantity: quantity.value,\r\n    price_at_add: props.product.discount > 0\r\n        ? parseFloat(calculateDiscountPrice(props.product.original_price, props.product.discount))\r\n        : props.product.original_price\r\n  }\r\n\r\n  try {\r\n    const response = await axios.post('/cart', cartData)\r\n    if (response.data.status === 'success') {\r\n      alert('成功添加到购物车！')\r\n    } else {\r\n      alert('添加失败：' + response.data.message)\r\n    }\r\n  } catch (err) {\r\n    console.error('添加到购物车失败', err)\r\n    alert('添加到购物车失败，请稍后再试')\r\n  }\r\n}\r\n</script>\r\n\r\n\r\n<style scoped>\r\n.stock-info {\r\n  margin-top: 8px;\r\n  font-size: 14px;\r\n  color: #666;\r\n}\r\n\r\n.product-rating {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 3px;\r\n}\r\n\r\n.half-star {\r\n  color: #FFC107;\r\n}\r\n.product-card {\r\n  background: white;\r\n  border-radius: 15px;\r\n  overflow: hidden;\r\n  box-shadow: var(--shadow);\r\n  transition: var(--transition);\r\n  position: relative;\r\n}\r\n\r\n.product-card:hover {\r\n  transform: translateY(-10px);\r\n  box-shadow: 0 15px 30px rgba(0,0,0,0.15);\r\n}\r\n\r\n.product-badge {\r\n  position: absolute;\r\n  top: 15px;\r\n  left: 15px;\r\n  background: var(--color4);\r\n  color: white;\r\n  padding: 5px 12px;\r\n  border-radius: 20px;\r\n  font-size: 12px;\r\n  font-weight: 500;\r\n  z-index: 2;\r\n}\r\n\r\n.product-img {\r\n  height: 200px;\r\n  background-size: cover;\r\n  background-position: center;\r\n}\r\n\r\n.product-info {\r\n  padding: 20px;\r\n}\r\n\r\n.product-info h3 {\r\n  margin-bottom: 8px;\r\n  font-size: 18px;\r\n}\r\n\r\n.product-price {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.original-price {\r\n  text-decoration: line-through;\r\n  color: #888;\r\n  font-size: 16px;\r\n}\r\n\r\n.discount-price {\r\n  font-weight: 700;\r\n  color: var(--color4);\r\n  font-size: 20px;\r\n}\r\n\r\n.normal-price {\r\n  font-weight: 700;\r\n  color: var(--color4);\r\n  font-size: 20px;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.product-rating {\r\n  color: #FFC107;\r\n  margin-bottom: 15px;\r\n  display: flex;\r\n  gap: 3px;\r\n}\r\n\r\n.product-rating span {\r\n  margin-left: 8px;\r\n  color: var(--color5);\r\n  font-size: 14px;\r\n}\r\n\r\n.add-to-cart {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.quantity {\r\n  display: flex;\r\n  align-items: center;\r\n  border: 1px solid #ddd;\r\n  border-radius: 30px;\r\n  padding: 5px 15px;\r\n}\r\n\r\n.quantity button {\r\n  background: none;\r\n  border: none;\r\n  font-size: 16px;\r\n  cursor: pointer;\r\n  color: var(--color5);\r\n}\r\n\r\n.quantity span {\r\n  margin: 0 10px;\r\n}\r\n\r\n.cart-btn {\r\n  position: relative;\r\n  background: var(--color3);\r\n  border: none;\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  cursor: pointer;\r\n  transition: var(--transition);\r\n  color: var(--color5);\r\n  z-index: 1;\r\n}\r\n\r\n.cart-btn:hover {\r\n  background: var(--color4);\r\n  color: white;\r\n  transform: scale(1.1);\r\n}\r\n</style>\r\n"],"mappings":";;EACOA,KAAK,EAAC;AAAc;;;EAEnBA,KAAK,EAAC;;;EAWLA,KAAK,EAAC;AAAc;;EAGlBA,KAAK,EAAC;AAAgB;;;EAStBA,KAAK,EAAC;;;EACHA,KAAK,EAAC;AAAgB;;EACtBA,KAAK,EAAC;AAAgB;;;EAIzBA,KAAK,EAAC;;;EAINA,KAAK,EAAC;AAAa;;EACjBA,KAAK,EAAC;AAAU;;EAUlBA,KAAK,EAAC;AAAY;;;uBA9C3BC,mBAAA,CAkDM,OAlDNC,UAkDM,GA/CMC,MAAA,CAAAC,OAAO,CAACC,QAAQ,Q,cAF1BJ,mBAAA,CAKM,OALNK,UAKM,EAFL,IACE,GAAAC,gBAAA,CAAGC,IAAI,CAACC,KAAK,CAACN,MAAA,CAAAC,OAAO,CAACC,QAAQ,WAAU,IAC3C,mB,mCAEAK,mBAAA,CAGO;IAFHV,KAAK,EAAC,aAAa;IAClBW,KAAK,EAAAC,eAAA;MAAAC,eAAA,SAA4BV,MAAA,CAAAC,OAAO,CAACU,KAAK;IAAA;2BAGnDJ,mBAAA,CAoCM,OApCNK,UAoCM,GAnCJL,mBAAA,CAA2B,YAAAH,gBAAA,CAApBJ,MAAA,CAAAC,OAAO,CAACY,IAAI,kBAEnBN,mBAAA,CAOM,OAPNO,UAOM,I,cANJhB,mBAAA,CAKEiB,SAAA,QAAAC,WAAA,CAJc,CAAC,EAANC,CAAC;WADZC,YAAA,CAKEC,4BAAA;MAHGC,GAAG,EAAEH,CAAC;MACNI,IAAI,EAAEC,MAAA,CAAAC,WAAW,CAACN,CAAC;MACnBpB,KAAK,EAAA2B,eAAA;QAAA,aAAiBP,CAAC,KAAKZ,IAAI,CAACoB,IAAI,CAACzB,MAAA,CAAAC,OAAO,CAACyB,MAAM,KAAK1B,MAAA,CAAAC,OAAO,CAACyB,MAAM;MAAA;;oCAI7C1B,MAAA,CAAAC,OAAO,CAACC,QAAQ,Q,cAAjDJ,mBAAA,CAKM,OALN6B,UAKM,GAJJpB,mBAAA,CAAiE,QAAjEqB,UAAiE,EAApC,GAAC,GAAAxB,gBAAA,CAAGJ,MAAA,CAAAC,OAAO,CAAC4B,cAAc,kBACvDtB,mBAAA,CAEO,QAFPuB,UAEO,EAFsB,IAC1B,GAAA1B,gBAAA,CAAGkB,MAAA,CAAAS,sBAAsB,CAAC/B,MAAA,CAAAC,OAAO,CAAC4B,cAAc,EAAE7B,MAAA,CAAAC,OAAO,CAACC,QAAQ,kB,oBAGvEJ,mBAAA,CAEM,OAFNkC,UAEM,EAF2B,IAC9B,GAAA5B,gBAAA,CAAGJ,MAAA,CAAAC,OAAO,CAAC4B,cAAc,mBAG5BtB,mBAAA,CASM,OATN0B,UASM,GARJ1B,mBAAA,CAIM,OAJN2B,WAIM,GAHJ3B,mBAAA,CAAqC;IAA5B4B,OAAK,EAAEb,MAAA,CAAAc;EAAS,GAAE,GAAC,GAC5B7B,mBAAA,CAA2B,cAAAH,gBAAA,CAAlBkB,MAAA,CAAAe,QAAQ,kBACjB9B,mBAAA,CAAqC;IAA5B4B,OAAK,EAAEb,MAAA,CAAAgB;EAAS,GAAE,GAAC,E,GAE9B/B,mBAAA,CAES;IAFDV,KAAK,EAAC,UAAU;IAAEsC,OAAK,EAAEb,MAAA,CAAAiB;MAC/BrB,YAAA,CAAsDC,4BAAA;IAAlCE,IAAI,EAAE;EAAwB,G,KAItDd,mBAAA,CAEM,OAFNiC,WAEM,EAFkB,UACf,GAAApC,gBAAA,CAAGJ,MAAA,CAAAC,OAAO,CAACwC,KAAK,iB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
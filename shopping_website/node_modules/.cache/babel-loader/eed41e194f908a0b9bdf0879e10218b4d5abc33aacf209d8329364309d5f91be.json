{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport { ref, onMounted, computed } from 'vue';\nimport axios from '@/api/axios';\nexport default {\n  __name: 'ShoppingCart',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const cartItems = ref([]);\n    const loading = ref(true);\n    const error = ref(null);\n    const username = ref('游客');\n    const isLoggedIn = ref(false);\n    const userId = ref(null);\n    const subtotal = computed(() => cartItems.value.reduce((sum, item) => sum + item.quantity * item.price_at_add, 0));\n    const shippingFee = computed(() => subtotal.value > 200 ? 0 : 15);\n    const total = computed(() => subtotal.value + shippingFee.value);\n    onMounted(async () => {\n      const userJson = localStorage.getItem('user');\n      if (!userJson) {\n        isLoggedIn.value = false;\n        loading.value = false;\n        return;\n      }\n      try {\n        const user = JSON.parse(userJson);\n        if (user && user.user_name) {\n          username.value = user.user_name;\n          isLoggedIn.value = true;\n          const userRes = await axios.get('/users');\n          const foundUser = userRes.data.data.find(u => u.user_name === username.value);\n          if (!foundUser) {\n            error.value = '未找到该用户';\n            loading.value = false;\n            return;\n          }\n          userId.value = foundUser.user_id;\n          const cartRes = await axios.get(`/cart/${userId.value}`);\n          if (cartRes.data.status === 'success') {\n            cartItems.value = cartRes.data.data;\n          } else {\n            error.value = cartRes.data.message;\n          }\n        }\n      } catch (err) {\n        console.error(err);\n        error.value = '加载购物车失败';\n      } finally {\n        loading.value = false;\n      }\n    });\n    const removeItem = item => {\n      console.log(\"删除商品\", item);\n    };\n    const proceedToCheckout = () => {\n      alert(`即将跳转到结算页面，总计 ¥${total.value.toFixed(2)}`);\n    };\n    const __returned__ = {\n      cartItems,\n      loading,\n      error,\n      username,\n      isLoggedIn,\n      userId,\n      subtotal,\n      shippingFee,\n      total,\n      removeItem,\n      proceedToCheckout,\n      ref,\n      onMounted,\n      computed,\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","axios","cartItems","loading","error","username","isLoggedIn","userId","subtotal","value","reduce","sum","item","quantity","price_at_add","shippingFee","total","userJson","localStorage","getItem","user","JSON","parse","user_name","userRes","get","foundUser","data","find","u","user_id","cartRes","status","message","err","console","removeItem","log","proceedToCheckout","alert","toFixed"],"sources":["D:/计算机/谭/shopping_website/src/views/ShoppingCart.vue"],"sourcesContent":["<template>\r\n  <div class=\"cart-container\">\r\n    <div class=\"cart-header\">\r\n      <h1 class=\"section-title\">我的购物车</h1>\r\n      <p class=\"cart-summary\" v-if=\"isLoggedIn\">共 {{ cartItems.length }} 件商品</p>\r\n    </div>\r\n\r\n    <div v-if=\"!isLoggedIn\" class=\"not-logged-in\">\r\n      <p>您尚未登录，请先 <a href=\"/login\">登录</a> 查看购物车。</p>\r\n    </div>\r\n\r\n    <div v-else class=\"cart-content\">\r\n      <div class=\"cart-items\">\r\n        <div v-if=\"loading\" class=\"loading-message\">正在加载购物车...</div>\r\n        <div v-else-if=\"error\" class=\"error-message\">{{ error }}</div>\r\n        <div v-else-if=\"cartItems.length === 0\" class=\"empty-cart\">购物车为空</div>\r\n\r\n        <div v-else>\r\n          <div class=\"cart-item\" v-for=\"item in cartItems\" :key=\"item.cart_id\">\r\n            <div class=\"item-image\">\r\n              <img :src=\"item.image\" :alt=\"item.name\" class=\"product-img\">\r\n            </div>\r\n            <div class=\"item-details\">\r\n              <h3 class=\"product-name\">{{ item.name }}</h3>\r\n            </div>\r\n            <div class=\"item-price\">\r\n              <p class=\"price\">¥{{ item.price_at_add.toFixed(2) }}</p>\r\n            </div>\r\n            <div class=\"item-quantity\">\r\n              <span class=\"quantity\">{{ item.quantity }}</span>\r\n            </div>\r\n            <div class=\"item-subtotal\">\r\n              <p class=\"subtotal\">¥{{ (item.price_at_add * item.quantity).toFixed(2) }}</p>\r\n            </div>\r\n            <div class=\"item-actions\">\r\n              <button class=\"action-btn delete\" @click=\"removeItem(item)\">\r\n                <font-awesome-icon :icon=\"['fas', 'trash']\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"cart-summary feathered-edge\" v-if=\"cartItems.length > 0\">\r\n        <div class=\"summary-header\">\r\n          <h3>订单摘要</h3>\r\n        </div>\r\n        <div class=\"summary-content\">\r\n          <div class=\"summary-row\">\r\n            <span>商品小计</span>\r\n            <span>¥{{ subtotal.toFixed(2) }}</span>\r\n          </div>\r\n          <div class=\"summary-row\">\r\n            <span>运费</span>\r\n            <span>¥{{ shippingFee.toFixed(2) }}</span>\r\n          </div>\r\n          <div class=\"summary-divider\"></div>\r\n          <div class=\"summary-row total\">\r\n            <span>总计</span>\r\n            <span>¥{{ total.toFixed(2) }}</span>\r\n          </div>\r\n        </div>\r\n        <button class=\"btn checkout-btn\" @click=\"proceedToCheckout\">\r\n          前往结账\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, computed } from 'vue'\r\nimport axios from '@/api/axios'\r\n\r\nconst cartItems = ref([])\r\nconst loading = ref(true)\r\nconst error = ref(null)\r\n\r\nconst username = ref('游客')\r\nconst isLoggedIn = ref(false)\r\nconst userId = ref(null)\r\n\r\nconst subtotal = computed(() =>\r\n    cartItems.value.reduce((sum, item) => sum + item.quantity * item.price_at_add, 0)\r\n)\r\n\r\nconst shippingFee = computed(() =>\r\n    subtotal.value > 200 ? 0 : 15\r\n)\r\n\r\nconst total = computed(() =>\r\n    subtotal.value + shippingFee.value\r\n)\r\n\r\nonMounted(async () => {\r\n  const userJson = localStorage.getItem('user')\r\n  if (!userJson) {\r\n    isLoggedIn.value = false\r\n    loading.value = false\r\n    return\r\n  }\r\n\r\n  try {\r\n    const user = JSON.parse(userJson)\r\n    if (user && user.user_name) {\r\n      username.value = user.user_name\r\n      isLoggedIn.value = true\r\n\r\n      const userRes = await axios.get('/users')\r\n      const foundUser = userRes.data.data.find(\r\n          u => u.user_name === username.value\r\n      )\r\n\r\n      if (!foundUser) {\r\n        error.value = '未找到该用户'\r\n        loading.value = false\r\n        return\r\n      }\r\n\r\n      userId.value = foundUser.user_id\r\n\r\n      const cartRes = await axios.get(`/cart/${userId.value}`)\r\n      if (cartRes.data.status === 'success') {\r\n        cartItems.value = cartRes.data.data\r\n      } else {\r\n        error.value = cartRes.data.message\r\n      }\r\n    }\r\n  } catch (err) {\r\n    console.error(err)\r\n    error.value = '加载购物车失败'\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n})\r\n\r\nconst removeItem = (item) => {\r\n  console.log(\"删除商品\", item);\r\n};\r\n\r\nconst proceedToCheckout = () => {\r\n  alert(`即将跳转到结算页面，总计 ¥${total.value.toFixed(2)}`);\r\n};\r\n</script>\r\n\r\n<style>\r\n.cart-container {\r\n  max-width: 1400px;\r\n  margin: 40px auto;\r\n  padding: 0 20px;\r\n}\r\n\r\n.cart-header {\r\n  margin-bottom: 30px;\r\n  border-bottom: 2px solid var(--color3);\r\n  padding-bottom: 20px;\r\n}\r\n\r\n.cart-summary {\r\n  color: var(--color4);\r\n  font-size: 18px;\r\n  margin-top: 10px;\r\n}\r\n\r\n.cart-content {\r\n  display: flex;\r\n  gap: 30px;\r\n}\r\n\r\n.cart-items {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 20px;\r\n}\r\n\r\n.cart-item {\r\n  display: flex;\r\n  background: white;\r\n  border-radius: 15px;\r\n  padding: 20px;\r\n  box-shadow: var(--shadow);\r\n  transition: var(--transition);\r\n  align-items: center;\r\n}\r\n\r\n.cart-item:hover {\r\n  transform: translateY(-5px);\r\n  box-shadow: 0 8px 20px rgba(0,0,0,0.12);\r\n}\r\n\r\n.item-image {\r\n  width: 120px;\r\n  height: 120px;\r\n  margin: 0 20px;\r\n  border-radius: 10px;\r\n  overflow: hidden;\r\n}\r\n\r\n.product-img {\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: cover;\r\n  transition: var(--transition);\r\n}\r\n\r\n.product-img:hover {\r\n  transform: scale(1.05);\r\n}\r\n\r\n.item-details {\r\n  flex: 1;\r\n  padding-right: 20px;\r\n}\r\n\r\n.product-name {\r\n  font-family: 'Playfair Display', serif;\r\n  font-size: 20px;\r\n  color: var(--color5);\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.item-price {\r\n  width: 120px;\r\n  text-align: right;\r\n  padding-right: 20px;\r\n}\r\n\r\n.price {\r\n  font-size: 18px;\r\n  font-weight: 700;\r\n  color: var(--color4);\r\n}\r\n\r\n.item-quantity {\r\n  width: 120px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 10px;\r\n}\r\n\r\n.quantity {\r\n  min-width: 30px;\r\n  text-align: center;\r\n  font-weight: 500;\r\n}\r\n\r\n.item-subtotal {\r\n  width: 100px;\r\n  text-align: right;\r\n  padding-right: 20px;\r\n}\r\n\r\n.subtotal {\r\n  font-size: 18px;\r\n  font-weight: 700;\r\n  color: var(--color5);\r\n}\r\n\r\n.item-actions {\r\n  width: 80px;\r\n  display: flex;\r\n  gap: 10px;\r\n}\r\n\r\n.action-btn {\r\n  width: 36px;\r\n  height: 36px;\r\n  border-radius: 50%;\r\n  border: none;\r\n  background: var(--color1);\r\n  color: var(--color4);\r\n  cursor: pointer;\r\n  transition: var(--transition);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.action-btn:hover {\r\n  background: var(--color3);\r\n  color: white;\r\n}\r\n\r\n.delete:hover {\r\n  background: #ff6b6b;\r\n}\r\n\r\n.cart-summary.feathered-edge {\r\n  width: 350px;\r\n  background: white;\r\n  border-radius: 15px;\r\n  padding: 25px;\r\n  box-shadow: var(--shadow);\r\n  position: relative;\r\n}\r\n\r\n.summary-header {\r\n  border-bottom: 2px solid var(--color2);\r\n  padding-bottom: 15px;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.summary-header h3 {\r\n  font-family: 'Playfair Display', serif;\r\n  font-size: 24px;\r\n  color: var(--color5);\r\n}\r\n\r\n.summary-content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 15px;\r\n  margin-bottom: 25px;\r\n}\r\n\r\n.summary-row {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  font-size: 16px;\r\n  color: var(--color5);\r\n}\r\n\r\n.summary-divider {\r\n  height: 1px;\r\n  background: var(--color2);\r\n  margin: 10px 0;\r\n}\r\n\r\n.total {\r\n  font-weight: 700;\r\n  font-size: 20px;\r\n  margin-top: 10px;\r\n}\r\n\r\n.checkout-btn {\r\n  width: 100%;\r\n  padding: 16px;\r\n  font-size: 18px;\r\n  font-weight: 600;\r\n}\r\n\r\n.not-logged-in {\r\n  text-align: center;\r\n  padding: 40px;\r\n  font-size: 18px;\r\n  color: #666;\r\n}\r\n\r\n.loading-message,\r\n.error-message,\r\n.empty-cart {\r\n  text-align: center;\r\n  padding: 40px;\r\n  font-size: 18px;\r\n}\r\n\r\n.error-message {\r\n  color: #ff6b6b;\r\n}\r\n\r\n/* 响应式设计 */\r\n@media (max-width: 992px) {\r\n  .cart-content {\r\n    flex-direction: column;\r\n  }\r\n\r\n  .cart-summary.feathered-edge {\r\n    width: 100%;\r\n  }\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .cart-item {\r\n    flex-wrap: wrap;\r\n    position: relative;\r\n    padding: 15px;\r\n  }\r\n\r\n  .item-image {\r\n    width: 80px;\r\n    height: 80px;\r\n    margin: 0 10px 0 0;\r\n  }\r\n\r\n  .item-price {\r\n    width: auto;\r\n    position: absolute;\r\n    top: 20px;\r\n    right: 20px;\r\n  }\r\n\r\n  .item-quantity {\r\n    width: auto;\r\n    margin: 10px 0;\r\n  }\r\n\r\n  .item-subtotal {\r\n    width: auto;\r\n    margin-right: 40px;\r\n  }\r\n\r\n  .item-actions {\r\n    position: absolute;\r\n    top: 15px;\r\n    right: 15px;\r\n  }\r\n}\r\n\r\n@media (max-width: 576px) {\r\n  .cart-header {\r\n    text-align: center;\r\n  }\r\n\r\n  .section-title {\r\n    font-size: 28px;\r\n  }\r\n\r\n  .cart-item {\r\n    padding: 15px 10px;\r\n  }\r\n\r\n  .item-details {\r\n    padding-right: 10px;\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref } from 'vue';\nimport { getAllProducts } from '@/api/product.js';\nexport function useProductFetch() {\n  const products = ref([]);\n  const loading = ref(false);\n  const error = ref(null);\n  const hasMore = ref(true);\n  const currentCategory = ref(null);\n  const page = ref(1);\n  const limit = 20;\n  const fetchProducts = async (category = null) => {\n    if (loading.value || !hasMore.value) return;\n    let apiResponse;\n    const params = {\n      page: page.value,\n      limit\n    };\n\n    // 添加分类参数\n    if (category) {\n      params.category = category;\n      currentCategory.value = category;\n    }\n    try {\n      loading.value = true;\n      error.value = null;\n      apiResponse = await getAllProducts(params);\n      console.log('API 响应:', apiResponse);\n      let productsData;\n      if (Array.isArray(apiResponse)) {\n        productsData = apiResponse;\n      } else if (apiResponse && Array.isArray(apiResponse.data)) {\n        productsData = apiResponse.data;\n      } else if (apiResponse && apiResponse.data && Array.isArray(apiResponse.data.data)) {\n        productsData = apiResponse.data.data;\n      } else {\n        throw new Error(`无效的API响应格式: ${typeof apiResponse}`);\n      }\n      if (productsData.length < limit) {\n        hasMore.value = false;\n      }\n\n      // 重置或追加商品\n      if (page.value === 1) {\n        products.value = productsData;\n      } else {\n        products.value.push(...productsData);\n      }\n      page.value++;\n    } catch (err) {\n      error.value = err.message || '获取商品失败';\n      console.error('API 错误详情:', err);\n    } finally {\n      loading.value = false;\n    }\n  };\n  const reset = () => {\n    products.value = [];\n    page.value = 1;\n    hasMore.value = true;\n    error.value = null;\n    currentCategory.value = null;\n  };\n  return {\n    products,\n    loading,\n    error,\n    hasMore,\n    currentCategory,\n    fetchProducts,\n    reset\n  };\n}","map":{"version":3,"names":["ref","getAllProducts","useProductFetch","products","loading","error","hasMore","currentCategory","page","limit","fetchProducts","category","value","apiResponse","params","console","log","productsData","Array","isArray","data","Error","length","push","err","message","reset"],"sources":["D:/计算机/谭/shopping_website/src/composables/useProductFetch.js"],"sourcesContent":["import { ref } from 'vue'\r\nimport { getAllProducts } from '@/api/product.js'\r\n\r\nexport function useProductFetch() {\r\n    const products = ref([])\r\n    const loading = ref(false)\r\n    const error = ref(null)\r\n    const hasMore = ref(true)\r\n    const currentCategory = ref(null)\r\n\r\n    const page = ref(1)\r\n    const limit = 20\r\n\r\n    const fetchProducts = async (category = null) => {\r\n        if (loading.value || !hasMore.value) return\r\n\r\n        let apiResponse\r\n        const params = {\r\n            page: page.value,\r\n            limit\r\n        }\r\n\r\n        // 添加分类参数\r\n        if (category) {\r\n            params.category = category\r\n            currentCategory.value = category\r\n        }\r\n\r\n        try {\r\n            loading.value = true\r\n            error.value = null\r\n\r\n            apiResponse = await getAllProducts(params)\r\n            console.log('API 响应:', apiResponse)\r\n\r\n            let productsData\r\n            if (Array.isArray(apiResponse)) {\r\n                productsData = apiResponse\r\n            } else if (apiResponse && Array.isArray(apiResponse.data)) {\r\n                productsData = apiResponse.data\r\n            } else if (\r\n                apiResponse &&\r\n                apiResponse.data &&\r\n                Array.isArray(apiResponse.data.data)\r\n            ) {\r\n                productsData = apiResponse.data.data\r\n            } else {\r\n                throw new Error(`无效的API响应格式: ${typeof apiResponse}`)\r\n            }\r\n\r\n            if (productsData.length < limit) {\r\n                hasMore.value = false\r\n            }\r\n\r\n            // 重置或追加商品\r\n            if (page.value === 1) {\r\n                products.value = productsData\r\n            } else {\r\n                products.value.push(...productsData)\r\n            }\r\n\r\n            page.value++\r\n        } catch (err) {\r\n            error.value = err.message || '获取商品失败'\r\n            console.error('API 错误详情:', err)\r\n        } finally {\r\n            loading.value = false\r\n        }\r\n    }\r\n\r\n    const reset = () => {\r\n        products.value = []\r\n        page.value = 1\r\n        hasMore.value = true\r\n        error.value = null\r\n        currentCategory.value = null\r\n    }\r\n\r\n    return {\r\n        products,\r\n        loading,\r\n        error,\r\n        hasMore,\r\n        currentCategory,\r\n        fetchProducts,\r\n        reset\r\n    }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
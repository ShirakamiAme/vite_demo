{"ast":null,"code":"import { ref } from 'vue';\nimport { getAllProducts } from '@/api/product.js';\nexport function useProductFetch(initialLimit = 20) {\n  const products = ref([]);\n  const loading = ref(false);\n  const error = ref(null);\n  const hasMore = ref(true);\n  totalItems.value += productsData.length;\n  const page = ref(1);\n  const limit = ref(initialLimit);\n  const fetchProducts = async (category = null) => {\n    if (loading.value || !hasMore.value) return;\n    let apiResponse;\n    const params = {\n      page: page.value,\n      limit: limit.value\n    };\n    if (category) {\n      params.category = category;\n    }\n    try {\n      loading.value = true;\n      error.value = null;\n      apiResponse = await getAllProducts(params);\n      console.log('API 响应:', apiResponse);\n      console.log('完整 API 响应结构:', JSON.stringify(apiResponse, null, 2));\n      let productsData = [];\n      let totalCount = 0;\n\n      // 处理不同的响应结构\n      if (apiResponse && Array.isArray(apiResponse)) {\n        productsData = apiResponse;\n        totalCount = apiResponse.length;\n      } else if (apiResponse && apiResponse.data && Array.isArray(apiResponse.data)) {\n        productsData = apiResponse.data;\n        totalCount = apiResponse.meta?.totalItems || apiResponse.total || productsData.length;\n      } else if (apiResponse && apiResponse.data && apiResponse.data.data && Array.isArray(apiResponse.data.data)) {\n        productsData = apiResponse.data.data;\n        totalCount = apiResponse.data.meta?.totalItems || apiResponse.data.total || productsData.length;\n      } else {\n        console.warn('无法识别的 API 结构，尝试直接使用响应:', apiResponse);\n        productsData = apiResponse || [];\n        totalCount = productsData.length;\n      }\n      totalItems.value = totalCount;\n      if (productsData.length < limit.value) {\n        hasMore.value = false;\n      } else {\n        const remaining = totalItems.value - (products.value.length + productsData.length);\n        hasMore.value = remaining > 0;\n      }\n      products.value = [...products.value, ...productsData];\n      page.value++;\n      console.log(`加载 ${productsData.length} 个商品，总计 ${products.value.length}/${totalItems.value}`);\n      console.log(`还有更多商品: ${hasMore.value}`);\n    } catch (err) {\n      error.value = err.message || '获取商品失败';\n      console.error('API 错误详情:', err);\n      if (apiResponse) {\n        console.warn('API 响应内容:', apiResponse);\n      }\n    } finally {\n      loading.value = false;\n    }\n  };\n  const reset = () => {\n    products.value = [];\n    page.value = 1;\n    hasMore.value = true;\n    totalItems.value = 0;\n    error.value = null;\n  };\n  return {\n    products,\n    loading,\n    error,\n    hasMore,\n    totalItems,\n    fetchProducts,\n    reset\n  };\n}","map":{"version":3,"names":["ref","getAllProducts","useProductFetch","initialLimit","products","loading","error","hasMore","totalItems","value","productsData","length","page","limit","fetchProducts","category","apiResponse","params","console","log","JSON","stringify","totalCount","Array","isArray","data","meta","total","warn","remaining","err","message","reset"],"sources":["D:/计算机/谭/shopping_website/src/composables/useProductFetch.js"],"sourcesContent":["import { ref } from 'vue'\r\nimport { getAllProducts } from '@/api/product.js'\r\n\r\nexport function useProductFetch(initialLimit = 20) {\r\n    const products = ref([])\r\n    const loading = ref(false)\r\n    const error = ref(null)\r\n    const hasMore = ref(true)\r\n    totalItems.value += productsData.length\r\n\r\n    const page = ref(1)\r\n    const limit = ref(initialLimit)\r\n\r\n    const fetchProducts = async (category = null) => {\r\n        if (loading.value || !hasMore.value) return\r\n\r\n        let apiResponse\r\n        const params = {\r\n            page: page.value,\r\n            limit: limit.value\r\n        }\r\n\r\n        if (category) {\r\n            params.category = category\r\n        }\r\n\r\n        try {\r\n            loading.value = true\r\n            error.value = null\r\n\r\n            apiResponse = await getAllProducts(params)\r\n            console.log('API 响应:', apiResponse)\r\n\r\n            console.log('完整 API 响应结构:', JSON.stringify(apiResponse, null, 2))\r\n\r\n            let productsData = []\r\n            let totalCount = 0\r\n\r\n            // 处理不同的响应结构\r\n            if (apiResponse && Array.isArray(apiResponse)) {\r\n                productsData = apiResponse\r\n                totalCount = apiResponse.length\r\n            } else if (apiResponse && apiResponse.data && Array.isArray(apiResponse.data)) {\r\n                productsData = apiResponse.data\r\n                totalCount = apiResponse.meta?.totalItems || apiResponse.total || productsData.length\r\n            } else if (apiResponse && apiResponse.data && apiResponse.data.data && Array.isArray(apiResponse.data.data)) {\r\n                productsData = apiResponse.data.data\r\n                totalCount = apiResponse.data.meta?.totalItems || apiResponse.data.total || productsData.length\r\n            } else {\r\n                console.warn('无法识别的 API 结构，尝试直接使用响应:', apiResponse)\r\n                productsData = apiResponse || []\r\n                totalCount = productsData.length\r\n            }\r\n\r\n            totalItems.value = totalCount\r\n\r\n            if (productsData.length < limit.value) {\r\n                hasMore.value = false\r\n            } else {\r\n                const remaining = totalItems.value - (products.value.length + productsData.length)\r\n                hasMore.value = remaining > 0\r\n            }\r\n\r\n            products.value = [...products.value, ...productsData]\r\n            page.value++\r\n\r\n            console.log(`加载 ${productsData.length} 个商品，总计 ${products.value.length}/${totalItems.value}`)\r\n            console.log(`还有更多商品: ${hasMore.value}`)\r\n\r\n        } catch (err) {\r\n            error.value = err.message || '获取商品失败'\r\n            console.error('API 错误详情:', err)\r\n            if (apiResponse) {\r\n                console.warn('API 响应内容:', apiResponse)\r\n            }\r\n        } finally {\r\n            loading.value = false\r\n        }\r\n    }\r\n\r\n    const reset = () => {\r\n        products.value = []\r\n        page.value = 1\r\n        hasMore.value = true\r\n        totalItems.value = 0\r\n        error.value = null\r\n    }\r\n\r\n    return {\r\n        products,\r\n        loading,\r\n        error,\r\n        hasMore,\r\n        totalItems,\r\n        fetchProducts,\r\n        reset\r\n    }\r\n}\r\n"],"mappings":"AAAA,SAASA,GAAG,QAAQ,KAAK;AACzB,SAASC,cAAc,QAAQ,kBAAkB;AAEjD,OAAO,SAASC,eAAeA,CAACC,YAAY,GAAG,EAAE,EAAE;EAC/C,MAAMC,QAAQ,GAAGJ,GAAG,CAAC,EAAE,CAAC;EACxB,MAAMK,OAAO,GAAGL,GAAG,CAAC,KAAK,CAAC;EAC1B,MAAMM,KAAK,GAAGN,GAAG,CAAC,IAAI,CAAC;EACvB,MAAMO,OAAO,GAAGP,GAAG,CAAC,IAAI,CAAC;EACzBQ,UAAU,CAACC,KAAK,IAAIC,YAAY,CAACC,MAAM;EAEvC,MAAMC,IAAI,GAAGZ,GAAG,CAAC,CAAC,CAAC;EACnB,MAAMa,KAAK,GAAGb,GAAG,CAACG,YAAY,CAAC;EAE/B,MAAMW,aAAa,GAAG,MAAAA,CAAOC,QAAQ,GAAG,IAAI,KAAK;IAC7C,IAAIV,OAAO,CAACI,KAAK,IAAI,CAACF,OAAO,CAACE,KAAK,EAAE;IAErC,IAAIO,WAAW;IACf,MAAMC,MAAM,GAAG;MACXL,IAAI,EAAEA,IAAI,CAACH,KAAK;MAChBI,KAAK,EAAEA,KAAK,CAACJ;IACjB,CAAC;IAED,IAAIM,QAAQ,EAAE;MACVE,MAAM,CAACF,QAAQ,GAAGA,QAAQ;IAC9B;IAEA,IAAI;MACAV,OAAO,CAACI,KAAK,GAAG,IAAI;MACpBH,KAAK,CAACG,KAAK,GAAG,IAAI;MAElBO,WAAW,GAAG,MAAMf,cAAc,CAACgB,MAAM,CAAC;MAC1CC,OAAO,CAACC,GAAG,CAAC,SAAS,EAAEH,WAAW,CAAC;MAEnCE,OAAO,CAACC,GAAG,CAAC,cAAc,EAAEC,IAAI,CAACC,SAAS,CAACL,WAAW,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;MAEjE,IAAIN,YAAY,GAAG,EAAE;MACrB,IAAIY,UAAU,GAAG,CAAC;;MAElB;MACA,IAAIN,WAAW,IAAIO,KAAK,CAACC,OAAO,CAACR,WAAW,CAAC,EAAE;QAC3CN,YAAY,GAAGM,WAAW;QAC1BM,UAAU,GAAGN,WAAW,CAACL,MAAM;MACnC,CAAC,MAAM,IAAIK,WAAW,IAAIA,WAAW,CAACS,IAAI,IAAIF,KAAK,CAACC,OAAO,CAACR,WAAW,CAACS,IAAI,CAAC,EAAE;QAC3Ef,YAAY,GAAGM,WAAW,CAACS,IAAI;QAC/BH,UAAU,GAAGN,WAAW,CAACU,IAAI,EAAElB,UAAU,IAAIQ,WAAW,CAACW,KAAK,IAAIjB,YAAY,CAACC,MAAM;MACzF,CAAC,MAAM,IAAIK,WAAW,IAAIA,WAAW,CAACS,IAAI,IAAIT,WAAW,CAACS,IAAI,CAACA,IAAI,IAAIF,KAAK,CAACC,OAAO,CAACR,WAAW,CAACS,IAAI,CAACA,IAAI,CAAC,EAAE;QACzGf,YAAY,GAAGM,WAAW,CAACS,IAAI,CAACA,IAAI;QACpCH,UAAU,GAAGN,WAAW,CAACS,IAAI,CAACC,IAAI,EAAElB,UAAU,IAAIQ,WAAW,CAACS,IAAI,CAACE,KAAK,IAAIjB,YAAY,CAACC,MAAM;MACnG,CAAC,MAAM;QACHO,OAAO,CAACU,IAAI,CAAC,wBAAwB,EAAEZ,WAAW,CAAC;QACnDN,YAAY,GAAGM,WAAW,IAAI,EAAE;QAChCM,UAAU,GAAGZ,YAAY,CAACC,MAAM;MACpC;MAEAH,UAAU,CAACC,KAAK,GAAGa,UAAU;MAE7B,IAAIZ,YAAY,CAACC,MAAM,GAAGE,KAAK,CAACJ,KAAK,EAAE;QACnCF,OAAO,CAACE,KAAK,GAAG,KAAK;MACzB,CAAC,MAAM;QACH,MAAMoB,SAAS,GAAGrB,UAAU,CAACC,KAAK,IAAIL,QAAQ,CAACK,KAAK,CAACE,MAAM,GAAGD,YAAY,CAACC,MAAM,CAAC;QAClFJ,OAAO,CAACE,KAAK,GAAGoB,SAAS,GAAG,CAAC;MACjC;MAEAzB,QAAQ,CAACK,KAAK,GAAG,CAAC,GAAGL,QAAQ,CAACK,KAAK,EAAE,GAAGC,YAAY,CAAC;MACrDE,IAAI,CAACH,KAAK,EAAE;MAEZS,OAAO,CAACC,GAAG,CAAC,MAAMT,YAAY,CAACC,MAAM,WAAWP,QAAQ,CAACK,KAAK,CAACE,MAAM,IAAIH,UAAU,CAACC,KAAK,EAAE,CAAC;MAC5FS,OAAO,CAACC,GAAG,CAAC,WAAWZ,OAAO,CAACE,KAAK,EAAE,CAAC;IAE3C,CAAC,CAAC,OAAOqB,GAAG,EAAE;MACVxB,KAAK,CAACG,KAAK,GAAGqB,GAAG,CAACC,OAAO,IAAI,QAAQ;MACrCb,OAAO,CAACZ,KAAK,CAAC,WAAW,EAAEwB,GAAG,CAAC;MAC/B,IAAId,WAAW,EAAE;QACbE,OAAO,CAACU,IAAI,CAAC,WAAW,EAAEZ,WAAW,CAAC;MAC1C;IACJ,CAAC,SAAS;MACNX,OAAO,CAACI,KAAK,GAAG,KAAK;IACzB;EACJ,CAAC;EAED,MAAMuB,KAAK,GAAGA,CAAA,KAAM;IAChB5B,QAAQ,CAACK,KAAK,GAAG,EAAE;IACnBG,IAAI,CAACH,KAAK,GAAG,CAAC;IACdF,OAAO,CAACE,KAAK,GAAG,IAAI;IACpBD,UAAU,CAACC,KAAK,GAAG,CAAC;IACpBH,KAAK,CAACG,KAAK,GAAG,IAAI;EACtB,CAAC;EAED,OAAO;IACHL,QAAQ;IACRC,OAAO;IACPC,KAAK;IACLC,OAAO;IACPC,UAAU;IACVM,aAAa;IACbkB;EACJ,CAAC;AACL","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}